<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>çŒ«å’ªæ¥é±¼ - é«˜éš¾ç‰ˆ</title>
    <style>
        :root {
            --bg: #0e1726;
            --accent: #22d3ee;
            --bad: #f87171;
            --warn: #fbbf24;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #0b1220, #0e1726 55%, #0b1220);
            color: #e5e7eb;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Microsoft Yahei", sans-serif
        }

        .wrap {
            width: min(92vw, 520px)
        }

        .hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            margin-bottom: 10px;
            background: #0b1220dd;
            border: 1px solid #1f2937;
            border-radius: 16px
        }

        .stat {
            font-weight: 800
        }

        .stat .v {
            color: var(--accent)
        }

        .btn {
            background: #111827;
            border: 1px solid #1f2937;
            color: #e5e7eb;
            border-radius: 12px;
            padding: 8px 12px;
            font-weight: 800;
            cursor: pointer
        }

        .game {
            position: relative;
            width: 100%;
            height: min(75vh, 680px);
            min-height: 480px;
            border: 1px solid #1f2937;
            border-radius: 18px;
            overflow: hidden;
            background: radial-gradient(100% 100% at 50% 0%, #0f1b2f 0%, #0b1220 70%)
        }

        .grid {
            position: absolute;
            inset: 0;
            opacity: .25;
            background:
                linear-gradient(#1f293714 1px, transparent 1px) 0 0/100% 20px,
                linear-gradient(90deg, #1f293714 1px, transparent 1px) 0 0/20px 100%
        }

        .floor {
            position: absolute;
            inset: auto 0 0 0;
            height: 14%;
            background: linear-gradient(0deg, rgba(34, 211, 238, .12), rgba(34, 211, 238, 0))
        }

        .cat {
            position: absolute;
            bottom: 8%;
            left: 50%;
            transform: translateX(-50%);
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px
        }

        .item {
            position: absolute;
            top: -60px;
            width: 46px;
            height: 46px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            will-change: transform, top, left
        }

        .overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: linear-gradient(180deg, rgba(0, 0, 0, .25), rgba(0, 0, 0, .35))
        }

        .title {
            font-weight: 900;
            font-size: clamp(22px, 4vw, 28px)
        }

        .pill {
            display: inline-flex;
            gap: 8px;
            padding: 8px 12px;
            border: 1px solid #22d3ee50;
            border-radius: 999px;
            background: #22d3ee1f
        }

        .kbd {
            font-family: ui-monospace, Menlo, monospace;
            border: 1px solid #1f2937;
            background: #0b1220;
            padding: 2px 6px;
            border-radius: 6px
        }

        .flash {
            animation: flash .18s ease
        }

        @keyframes flash {
            from {
                background: #f8717140
            }

            to {
                background: transparent
            }
        }

        .shake {
            animation: shake .28s ease
        }

        @keyframes shake {
            0% {
                transform: translateX(-50%)
            }

            25% {
                transform: translateX(calc(-50% - 6px))
            }

            50% {
                transform: translateX(-50%)
            }

            75% {
                transform: translateX(calc(-50% + 6px))
            }

            100% {
                transform: translateX(-50%)
            }
        }

        .slow {
            filter: hue-rotate(-25deg) brightness(1.05) drop-shadow(0 0 10px rgba(251, 191, 36, .35))
        }

        .foot {
            opacity: .75;
            font-size: 12px;
            text-align: center;
            margin-top: 6px
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="hud">
            <div class="stat">åˆ†æ•°ï¼š<span id="score" class="v">0</span></div>
            <div class="stat">å…³å¡ï¼š<span id="level" class="v">1</span></div>
            <div class="stat">å‘½ï¼š<span id="lives" class="v">2</span></div>
            <button id="toggle" class="btn">å¼€å§‹</button>
        </div>
        <div id="game" class="game" aria-label="æ¸¸æˆåŒºåŸŸ">
            <div class="grid"></div>
            <div id="intro" class="overlay">
                <div class="title">ã€ŠçŒ«å’ªæ¥é±¼ã€‹â€” é«˜éš¾ç‰ˆ</div>
                <div>æ¥ ğŸŸ åŠ åˆ†ï¼›ğŸ’£ æ‰£ 1 å‘½ï¼›ğŸ‘¢ å‡é€Ÿ 4 ç§’ï¼›<b>ğŸª¨ æ‰£ 2 å‘½</b>ï¼</div>
                <div class="pill">æ“ä½œï¼š
                    <span class="kbd">â†</span><span class="kbd">â†’</span> æˆ– <span class="kbd">A</span>/<span
                        class="kbd">D</span>ï¼›æ‰‹æœºæ‹–åŠ¨
                </div>
                <button id="start" class="btn">å¼€å§‹æ¸¸æˆ</button>
                <div class="foot">æ¯ <b>7</b> æ¡é±¼å‡ä¸€å…³ï¼›æ›´å¿«çš„ä¸‹è½ + â€œé£åç§»â€ï¼›å¶å°”åŒé‡æ‰è½ã€‚</div>
            </div>
            <div id="cat" class="cat" role="img" aria-label="çŒ«å’ª">ğŸ±</div>
            <div class="floor"></div>
        </div>
        <div class="foot">æç¤ºï¼šä¿æŒå±…ä¸­ï¼Œç­‰èŠ‚å¥å½¢æˆå†åˆ‡è¾¹æŠ¢ç‚¹ä½ã€‚</div>
    </div>

    <script>
        (() => {
            // ====== éš¾åº¦è°ƒå‚ï¼ˆä½ å¯ä»¥ç»§ç»­å¾®è°ƒï¼‰======
            const DIFFICULTY = {
                initialLives: 2,
                levelUpEvery: 7,          // æ¯å‡ æ¡é±¼å‡ä¸€å…³
                spawnEveryMs: 650,        // åˆå§‹ç”Ÿæˆé—´éš”ï¼ˆè¶Šå°è¶Šéš¾ï¼‰
                fallSpeed: 200,           // åˆå§‹ä¸‹è½é€Ÿåº¦ px/s
                minSpawnMs: 220,          // ç”Ÿæˆé—´éš”ä¸‹é™
                maxFallSpeed: 520,        // ä¸‹è½é€Ÿåº¦ä¸Šé™
                spawnStep: 70,            // å‡çº§æ—¶ç”Ÿæˆé—´éš”é€’å‡
                fallStep: 35,             // å‡çº§æ—¶é€Ÿåº¦å¢åŠ 
                slowFactor: 0.5,          // ğŸ‘¢ å‡é€Ÿå€æ•°
                slowDuration: 4000,       // ğŸ‘¢ å‡é€Ÿæ—¶é•¿ ms
                windMax: 70,              // æ°´å¹³é£åç§»æœ€å¤§é€Ÿåº¦ px/s
                windJitter: 40,           // é£æŠ–åŠ¨ï¼ˆæ¯å¸§å¾®è°ƒï¼‰px/s^2
                doubleSpawnChance: 0.18,  // è§¦å‘åŒé‡æ‰è½æ¦‚ç‡
            };

            const game = document.getElementById('game');
            const catEl = document.getElementById('cat');
            const scoreEl = document.getElementById('score');
            const levelEl = document.getElementById('level');
            const livesEl = document.getElementById('lives');
            const startBtn = document.getElementById('start');
            const toggleBtn = document.getElementById('toggle');
            const intro = document.getElementById('intro');

            const WIDTH = () => game.clientWidth;
            const HEIGHT = () => game.clientHeight;

            const state = {
                running: false, gameOver: false,
                score: 0, level: 1, lives: DIFFICULTY.initialLives, fishCaught: 0,
                spawnEveryMs: DIFFICULTY.spawnEveryMs, fallSpeed: DIFFICULTY.fallSpeed,
                catX: 0.5, catSpeed: 560,
                slowUntil: 0, lastSpawn: 0, items: [], lastFrame: 0,
                keys: new Set(), pointerActive: false
            };

            // ç‰©å“ç±»å‹ï¼šå¢åŠ â€œğŸª¨â€æ‰£ 2 å‘½
            const TYPES = [
                { kind: 'fish', emoji: 'ğŸŸ', points: +1, weight: 50 },
                { kind: 'bomb', emoji: 'ğŸ’£', life: -1, weight: 25 },
                { kind: 'boot', emoji: 'ğŸ‘¢', slow: true, weight: 12 },
                { kind: 'rock', emoji: 'ğŸª¨', life: -2, weight: 13 }, // é«˜ä¼¤
            ];
            const totalWeight = TYPES.reduce((a, t) => a + t.weight, 0);
            const pickType = () => {
                let r = Math.random() * totalWeight;
                for (const t of TYPES) { if ((r -= t.weight) < 0) return t; }
                return TYPES[0];
            };

            function reset() {
                // æ¸…ç†
                for (const it of state.items) { it.el.remove(); }
                state.items.length = 0;

                Object.assign(state, {
                    running: false, gameOver: false,
                    score: 0, level: 1, lives: DIFFICULTY.initialLives, fishCaught: 0,
                    spawnEveryMs: DIFFICULTY.spawnEveryMs,
                    fallSpeed: DIFFICULTY.fallSpeed,
                    catX: 0.5, slowUntil: 0, lastSpawn: 0, lastFrame: 0
                });
                updateHUD(); setCatX(state.catX, true);
                game.classList.remove('flash'); catEl.classList.remove('shake', 'slow');
            }

            function updateHUD() {
                scoreEl.textContent = state.score;
                levelEl.textContent = state.level;
                livesEl.textContent = state.lives;
            }

            function setCatX(ratio, clamp = true) {
                if (clamp) {
                    const catW = catEl.clientWidth || 56;
                    const pad = catW / 2 / WIDTH();
                    ratio = Math.min(1 - pad, Math.max(pad, ratio));
                }
                state.catX = ratio;
                catEl.style.left = (ratio * WIDTH()) + 'px';
            }

            function spawnOnce(forceType = null) {
                const t = forceType || pickType();
                const el = document.createElement('div');
                el.className = 'item';
                el.textContent = t.emoji;
                const w = WIDTH();
                const x = Math.random() * (w - 46);
                el.style.left = x + 'px';
                game.appendChild(el);

                // åˆå§‹æ°´å¹³é£åç§»é€Ÿåº¦
                const vx = (Math.random() * 2 - 1) * DIFFICULTY.windMax;
                state.items.push({ t, el, x, y: -56, vy: state.fallSpeed, vx });
            }

            function spawn() {
                spawnOnce();
                // æ¦‚ç‡è§¦å‘åŒé‡æ‰è½ï¼ˆåŠ å‹åŠ›ï¼‰
                if (Math.random() < DIFFICULTY.doubleSpawnChance) {
                    // ç¬¬äºŒä¸ªå¼ºåˆ¶ä¸æ˜¯åŒä¸€ä½ç½®
                    spawnOnce();
                }
            }

            function collide(a, b) {
                return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
            }

            function handleCatch(item, ts) {
                const { t } = item;
                if (t.kind === 'fish') {
                    state.score += t.points;
                    state.fishCaught += 1;
                    // å‡çº§ï¼šæ¯ N æ¡é±¼
                    if (state.fishCaught % DIFFICULTY.levelUpEvery === 0) {
                        state.level += 1;
                        state.fallSpeed = Math.min(DIFFICULTY.maxFallSpeed, state.fallSpeed + DIFFICULTY.fallStep);
                        state.spawnEveryMs = Math.max(DIFFICULTY.minSpawnMs, state.spawnEveryMs - DIFFICULTY.spawnStep);
                        flash(game, 'flash');
                    }
                } else if (t.kind === 'bomb' || t.kind === 'rock') {
                    state.lives += (t.life || 0); // t.life ä¸ºè´Ÿæ•°
                    shake(catEl); flash(game, 'flash');
                    if (state.lives <= 0) { return gameOver(); }
                } else if (t.kind === 'boot') {
                    // å‡é€Ÿ
                    state.slowUntil = Math.max(state.slowUntil, ts + DIFFICULTY.slowDuration);
                    catEl.classList.add('slow');
                }
                updateHUD();
            }

            function removeItem(item) {
                item.el.remove();
                const i = state.items.indexOf(item);
                if (i >= 0) state.items.splice(i, 1);
            }

            function gameOver() {
                state.gameOver = true;
                state.running = false;
                showOverlay(`
      <div class="title">æ¸¸æˆç»“æŸ</div>
      <div>åˆ†æ•°ï¼š<b style="color:var(--accent)">${state.score}</b>ã€€å…³å¡ï¼š<b style="color:var(--accent)">${state.level}</b></div>
      <button class="btn" id="again">å†æ¥ä¸€å±€</button>
    `);
                document.getElementById('again').addEventListener('click', () => {
                    hideOverlay(); reset(); startGame();
                });
            }

            function flash(el, cls) { el.classList.remove(cls); void el.offsetWidth; el.classList.add(cls); setTimeout(() => el.classList.remove(cls), 200); }
            function shake(el) { el.classList.remove('shake'); void el.offsetWidth; el.classList.add('shake'); setTimeout(() => el.classList.remove('shake'), 300); }
            function showOverlay(html) { intro.innerHTML = html; intro.style.display = 'flex'; }
            function hideOverlay() { intro.style.display = 'none'; }

            function tick(ts) {
                if (!state.running) { state.lastFrame = ts; return; }
                const dt = Math.min(50, ts - (state.lastFrame || ts)); state.lastFrame = ts;

                // çŒ«ç§»åŠ¨ï¼ˆå«å‡é€Ÿï¼‰
                const left = state.keys.has('ArrowLeft') || state.keys.has('KeyA');
                const right = state.keys.has('ArrowRight') || state.keys.has('KeyD');
                let speed = state.catSpeed;
                if (ts < state.slowUntil) { speed *= DIFFICULTY.slowFactor; } else { catEl.classList.remove('slow'); }
                let dx = 0;
                if (left && !right) dx = -speed * (dt / 1000);
                if (right && !left) dx = +speed * (dt / 1000);
                if (dx !== 0) { setCatX(state.catX + dx / WIDTH()); }

                // ç”Ÿæˆ
                if (ts - state.lastSpawn > state.spawnEveryMs) {
                    spawn(); state.lastSpawn = ts;
                }

                // æ›´æ–°ä¸‹è½ + é£åç§» + ç¢°æ’
                const catRect = catEl.getBoundingClientRect();
                const gameRect = game.getBoundingClientRect();
                const catBox = { left: catRect.left, right: catRect.right, top: catRect.top, bottom: catRect.bottom };

                for (const item of [...state.items]) {
                    // åŠ å¼ºé‡åŠ› & é£ï¼šæ°´å¹³é€Ÿåº¦å¸¦è½»å¾®æŠ–åŠ¨
                    const g = (state.fallSpeed + (state.level - 1) * 10);
                    item.vy = g;
                    // é£æŠ–åŠ¨ï¼ˆè®©è½¨è¿¹ä¸ç¨³å®šï¼‰
                    const jitter = (Math.random() * 2 - 1) * DIFFICULTY.windJitter * (dt / 1000);
                    item.vx = Math.max(-DIFFICULTY.windMax, Math.min(DIFFICULTY.windMax, item.vx + jitter));

                    item.y += item.vy * (dt / 1000);
                    item.x += item.vx * (dt / 1000);

                    // è¾¹ç•Œå›å¼¹ï¼Œé¿å…ä¸€ç›´é£˜å‡ºå±å¹•
                    if (item.x < 0) { item.x = 0; item.vx = Math.abs(item.vx); }
                    if (item.x > WIDTH() - 46) { item.x = WIDTH() - 46; item.vx = -Math.abs(item.vx); }

                    item.el.style.top = item.y + 'px';
                    item.el.style.left = item.x + 'px';

                    const r = item.el.getBoundingClientRect();
                    const itBox = { left: r.left, right: r.right, top: r.top, bottom: r.bottom };

                    if (collide(catBox, itBox)) {
                        handleCatch(item, ts);
                        removeItem(item);
                        continue;
                    }
                    if (r.top > gameRect.bottom) { removeItem(item); }
                }

                requestAnimationFrame(tick);
            }

            function startGame() { state.running = true; state.gameOver = false; toggleBtn.textContent = 'æš‚åœ'; requestAnimationFrame(tick); }
            function pauseGame() { state.running = false; toggleBtn.textContent = 'ç»§ç»­'; }

            // äº‹ä»¶ï¼šé”®ç›˜
            window.addEventListener('keydown', (e) => {
                if (['ArrowLeft', 'ArrowRight', 'KeyA', 'KeyD', 'Space'].includes(e.code)) e.preventDefault();
                if (['ArrowLeft', 'ArrowRight', 'KeyA', 'KeyD'].includes(e.code)) state.keys.add(e.code);
                if (e.code === 'Space' && !state.gameOver) { state.running ? pauseGame() : startGame(); }
            });
            window.addEventListener('keyup', (e) => state.keys.delete(e.code));

            // æŒ‡é’ˆä¸è§¦æ§
            const pointer = { startX: 0, startCat: 0 };
            const cx = ev => ev.touches ? ev.touches[0].clientX : ev.clientX;
            game.addEventListener('pointerdown', e => { state.pointerActive = true; pointer.startX = e.clientX; pointer.startCat = state.catX; });
            window.addEventListener('pointermove', e => { if (!state.pointerActive) return; setCatX(pointer.startCat + (e.clientX - pointer.startX) / WIDTH()); });
            window.addEventListener('pointerup', () => state.pointerActive = false);
            game.addEventListener('touchstart', e => { state.pointerActive = true; pointer.startX = cx(e); pointer.startCat = state.catX; }, { passive: true });
            game.addEventListener('touchmove', e => { if (!state.pointerActive) return; setCatX(pointer.startCat + (cx(e) - pointer.startX) / WIDTH()); }, { passive: true });
            window.addEventListener('touchend', () => state.pointerActive = false);

            // æ§åˆ¶æŒ‰é’®
            document.getElementById('start').addEventListener('click', () => { hideOverlay(); reset(); startGame(); });
            toggleBtn.addEventListener('click', () => { if (state.gameOver) return; state.running ? pauseGame() : startGame(); });

            // åˆå§‹åŒ–
            reset();
            window.addEventListener('resize', () => setCatX(state.catX, true));
        })();
    </script>
</body>

</html>